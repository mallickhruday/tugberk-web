@{
    Layout = "_Layout";
}

@section styles {
    <link rel="stylesheet" href="/node_modules/summernote/dist/summernote-bs4.css">
}

@section scripts {
    <script src="/node_modules/summernote/dist/summernote-bs4.min.js"></script>
    <script>
        (function() {
            $(document).ready(function() {
                var $summernote = $('#summernote');
                $summernote.summernote({
                    height: 400,
                    callbacks: {
                        onImageUpload: function(files) {
                            $summernote.summernote('disable');

                            var data = new FormData();
                            for (var i = 0; i < files.length ; i++) {
                                data.append(files[i].name, files[i]);
                            }

                            fetch('/portal/images/upload', {
                                method: 'POST',
                                body: data
                            }).then(function(res) {
                                if(res.status === 201) {
                                    res.json().then(function(responseData) {
                                        var $uploadedImage = $('<img>')
                                            .attr('src', responseData.imageUrl);

                                        $summernote.summernote('enable');
                                        $summernote.summernote('insertNode', $uploadedImage[0]);
                                    });
                                } else {
                                    throw {
                                        message: 'image upload failed: ' + res.statusText,
                                        statusCode: res.status
                                    };
                                }
                            }).catch(x => {
                                console.error(x);
                                $summernote.summernote('enable');
                            });
                        }
                    }
                });
            });
        }());
    </script>
}

<h1>Hello...</h1>

<textarea id="summernote" name="content">Hello Summernote...</textarea>